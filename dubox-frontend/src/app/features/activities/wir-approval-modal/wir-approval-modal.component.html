<div *ngIf="isOpen" class="modal-overlay" (click)="close()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>QA/QC Inspection - {{ wirRecord?.wirCode }}</h2>
      <button class="modal-close" (click)="close()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <!-- WIR Info -->
      <div class="wir-info">
        <div class="info-item">
          <span class="label">WIR Code:</span>
          <span class="value">{{ wirRecord?.wirCode }}</span>
        </div>
        <div class="info-item">
          <span class="label">Activity:</span>
          <span class="value">{{ wirRecord?.activityName }}</span>
        </div>
        <div class="info-item">
          <span class="label">Box Tag:</span>
          <span class="value">{{ wirRecord?.boxTag }}</span>
        </div>
        <div class="info-item">
          <span class="label">Status:</span>
          <span class="value status-badge" [ngClass]="'status-' + wirRecord?.status?.toLowerCase()">
            {{ wirRecord?.status }}
          </span>
        </div>
      </div>

      <!-- Success Message -->
      <div *ngIf="successMessage" class="alert alert-success">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
        <span>{{ successMessage }}</span>
      </div>

      <!-- Error Message -->
      <div *ngIf="error" class="alert alert-error">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span>{{ error }}</span>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button 
          class="tab" 
          [class.active]="activeTab === 'approve'"
          [class.disabled]="!canApprove()"
          (click)="setActiveTab('approve')"
          [disabled]="!canApprove()"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
          Approve
        </button>
        <button 
          class="tab" 
          [class.active]="activeTab === 'reject'"
          [class.disabled]="!canReject()"
          (click)="setActiveTab('reject')"
          [disabled]="!canReject()"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="15" y1="9" x2="9" y2="15"/>
            <line x1="9" y1="9" x2="15" y2="15"/>
          </svg>
          Reject
        </button>
      </div>

      <!-- Approve Form -->
      <form *ngIf="activeTab === 'approve'" [formGroup]="approvalForm" (ngSubmit)="onApprove()">
        <div class="form-group">
          <label for="inspectionNotes">Inspection Notes (Optional)</label>
          <textarea
            id="inspectionNotes"
            formControlName="inspectionNotes"
            class="form-control"
            rows="4"
            placeholder="Enter inspection notes, observations, or comments..."
          ></textarea>
          <div *ngIf="approvalForm.get('inspectionNotes')?.invalid && approvalForm.get('inspectionNotes')?.touched" class="error-text">
            Maximum 1000 characters
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="close()" [disabled]="processing">
            Cancel
          </button>
          <button type="submit" class="btn btn-success" [disabled]="processing || approvalForm.invalid || !canApprove()">
            <span *ngIf="processing">Processing...</span>
            <span *ngIf="!processing">Approve WIR</span>
          </button>
        </div>
      </form>

      <!-- Reject Form -->
      <form *ngIf="activeTab === 'reject'" [formGroup]="rejectionForm" (ngSubmit)="onReject()">
        <div class="form-group">
          <label for="rejectionReason">Rejection Reason <span class="required">*</span></label>
          <textarea
            id="rejectionReason"
            formControlName="rejectionReason"
            class="form-control"
            rows="3"
            placeholder="Enter the reason for rejection. This will be sent to the team for rework."
            [class.invalid]="rejectionForm.get('rejectionReason')?.invalid && rejectionForm.get('rejectionReason')?.touched"
          ></textarea>
          <div *ngIf="rejectionForm.get('rejectionReason')?.invalid && rejectionForm.get('rejectionReason')?.touched" class="error-text">
            Rejection reason is required (max 500 characters)
          </div>
        </div>

        <div class="form-group">
          <label for="rejectionInspectionNotes">Inspection Notes (Optional)</label>
          <textarea
            id="rejectionInspectionNotes"
            formControlName="inspectionNotes"
            class="form-control"
            rows="3"
            placeholder="Additional inspection notes or observations..."
          ></textarea>
          <div *ngIf="rejectionForm.get('inspectionNotes')?.invalid && rejectionForm.get('inspectionNotes')?.touched" class="error-text">
            Maximum 1000 characters
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="close()" [disabled]="processing">
            Cancel
          </button>
          <button type="submit" class="btn btn-danger" [disabled]="processing || rejectionForm.invalid || !canReject()">
            <span *ngIf="processing">Processing...</span>
            <span *ngIf="!processing">Reject WIR</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>


