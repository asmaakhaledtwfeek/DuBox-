<div class="add-checklist-items-page">
  <app-header></app-header>
  <div class="page-container">
    <app-sidebar></app-sidebar>
    
    <main class="main-content">
      <div class="page-header">
        <h1 class="page-title">Add Checklist Items</h1>
        <p class="page-subtitle" *ngIf="wirCheckpoint">WIR Checkpoint: {{ wirCheckpoint.wirNumber }}</p>
      </div>

      <!-- Loading State -->
      <div class="loading-container" *ngIf="loading">
        <div class="spinner"></div>
        <p>Loading WIR checkpoint...</p>
      </div>

      <!-- Error State -->
      <div class="error-container" *ngIf="error && !loading">
        <p class="error-message">{{ error }}</p>
        <button class="btn btn-primary" (click)="loadWIRCheckpoint()">Retry</button>
      </div>

      <!-- Add Checklist Items Form -->
      <div class="form-container" *ngIf="wirCheckpoint && !loading && !error">
        <form [formGroup]="checklistForm" (ngSubmit)="onSubmit()">
          <!-- Error Message -->
          <div *ngIf="error" class="alert alert-error">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 8v4M12 16h.01"/>
            </svg>
            {{ error }}
          </div>

          <!-- Checklist Items Header -->
          <div class="checklist-header">
            <div>
              <h3>Select Predefined Checklist Items</h3>
              <p>Select items from the predefined checklist to add to this checkpoint</p>
            </div>
            <div *ngIf="selectedPredefinedItemIds.length > 0" class="selection-count">
              {{ selectedPredefinedItemIds.length }} item(s) selected
            </div>
          </div>

          <!-- Loading State for Predefined Items -->
          <div class="loading-container" *ngIf="loadingPredefinedItems">
            <div class="spinner"></div>
            <p>Loading predefined checklist items...</p>
          </div>

          <!-- Predefined Checklist Items -->
          <div class="predefined-items-container" *ngIf="!loadingPredefinedItems">
            <div class="empty-checklist" *ngIf="availablePredefinedItems.length === 0">
              <p>All predefined checklist items have been added to this checkpoint.</p>
            </div>

            <div 
              *ngFor="let item of availablePredefinedItems" 
              class="predefined-item-card"
              [class.selected]="isPredefinedItemSelected(item.predefinedItemId)"
              (click)="togglePredefinedItemSelection(item.predefinedItemId)"
            >
              <div class="item-checkbox">
                <input 
                  type="checkbox" 
                  [checked]="isPredefinedItemSelected(item.predefinedItemId)"
                  (change)="togglePredefinedItemSelection(item.predefinedItemId)"
                  (click)="$event.stopPropagation()"
                />
              </div>
              <div class="item-content">
                <div class="item-header">
                  <span class="item-sequence">#{{ item.sequence }}</span>
                  <span class="item-category" *ngIf="item.category">{{ item.category }}</span>
                </div>
                <p class="item-description">{{ item.checkpointDescription }}</p>
                <p class="item-reference" *ngIf="item.referenceDocument">
                  <strong>Reference:</strong> {{ item.referenceDocument }}
                </p>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="goBack()" [disabled]="submitting">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="submitting || selectedPredefinedItemIds.length === 0">
              <span *ngIf="!submitting">Add Selected Items ({{ selectedPredefinedItemIds.length }})</span>
              <span *ngIf="submitting">
                <span class="spinner-inline">
                  <span class="spinner small"></span>
                </span>
                Adding...
              </span>
            </button>
          </div>
        </form>
      </div>
    </main>
  </div>
</div>

