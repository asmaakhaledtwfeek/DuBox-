<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="page-container">
  <div class="page-content">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-left">
        <div class="breadcrumb" *ngIf="showBoxTypes">
          <button class="breadcrumb-link" (click)="backToProject()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
            Project
          </button>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">Box Types</span>
        </div>
        <div class="breadcrumb" *ngIf="!showBoxTypes && selectedBoxType">
          <button class="breadcrumb-link" (click)="backToBoxTypes()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
            Box Types
          </button>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">{{ selectedBoxType }}</span>
          <span *ngIf="selectedBoxSubType">
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">{{ selectedBoxSubType }}</span>
          </span>
        </div>
        <h1 class="page-title">{{ showBoxTypes ? 'Box Types' : 'Boxes' }}</h1>
        <p class="page-subtitle" *ngIf="projectName || projectCode">
          <span *ngIf="projectCode" class="project-code">{{ projectCode }}</span>
          <span *ngIf="projectName" class="project-name">{{ projectName }}</span>
        </p>
        <p class="page-helper">
          {{ showBoxTypes ? 'Select a box type to view boxes' : 'Manage boxes for ' + selectedBoxType + (selectedBoxSubType ? ' - ' + selectedBoxSubType : '') }}
        </p>
      </div>
      <div class="header-right" *ngIf="canCreate">
        <button class="btn btn-primary" (click)="createBox()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Add Box
        </button>
      </div>
    </div>

    <!-- Filters for Box Types -->
    <div class="filters-section" *ngIf="showBoxTypes && boxTypes.length > 0">
      
      
      <!-- Filter Dropdowns Row -->
      <div class="filters-row">
        <div class="filter-group">
          <label for="boxTypeFilter" class="filter-label">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            </svg>
            Box Type:
          </label>
          <select id="boxTypeFilter" [(ngModel)]="selectedFilterBoxType" (change)="applyBoxTypeFilters()" class="filter-select">
            <option value="">All Box Types</option>
            <option *ngFor="let type of availableBoxTypes" [value]="type">{{ type }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="subTypeFilter" class="filter-label">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="5" y="5" width="14" height="14" rx="1" ry="1"/>
            </svg>
            Sub Type:
          </label>
          <select id="subTypeFilter" [(ngModel)]="selectedFilterSubType" (change)="applyBoxTypeFilters()" class="filter-select">
            <option value="">All Sub Types</option>
            <option *ngFor="let subType of availableSubTypes" [value]="subType">{{ subType }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="buildingFilter" class="filter-label">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            </svg>
            Building:
          </label>
          <select id="buildingFilter" [(ngModel)]="selectedFilterBuilding" (change)="applyBoxTypeFilters()" class="filter-select">
            <option value="">All Buildings</option>
            <option *ngFor="let building of availableBuildings" [value]="building">{{ building }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="floorFilter" class="filter-label">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 3h18v4H3z"/>
              <path d="M3 11h18v4H3z"/>
              <path d="M3 19h18v2H3z"/>
            </svg>
            Floor:
          </label>
          <select id="floorFilter" [(ngModel)]="selectedFilterFloor" (change)="applyBoxTypeFilters()" class="filter-select">
            <option value="">All Floors</option>
            <option *ngFor="let floor of availableFloors" [value]="floor">{{ floor }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="zoneFilter" class="filter-label">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            Zone:
          </label>
          <select id="zoneFilter" [(ngModel)]="selectedFilterZone" (change)="applyBoxTypeFilters()" class="filter-select">
            <option value="">All Zones</option>
            <option *ngFor="let zone of availableZones" [value]="zone">{{ zone }}</option>
          </select>
        </div>

        <button 
          class="btn btn-clear-filters" 
          *ngIf="hasActiveFilters()"
          (click)="clearBoxTypeFilters()"
          title="Clear all filters"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
          Clear Filters
        </button>
      </div>
      
      <div class="results-count" *ngIf="boxTypeSearchControl.value || hasActiveFilters()">
        <span class="count-badge">{{ filteredBoxTypes.length }} of {{ boxTypes.length }} box types</span>
      </div>
    </div>

    <!-- Filters (only show when viewing boxes) -->
    <div class="filters-section" *ngIf="!showBoxTypes">
      <!-- Search and Status Filters Row -->
      <div class="search-and-status-row">
        <div class="search-box">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input 
            type="text" 
            placeholder="Search boxes by name, code, serial number, type, or activity..." 
            [formControl]="searchControl"
            class="search-input"
          />
        </div>

        <div class="filter-buttons">
          <button 
            class="filter-btn" 
            [class.active]="selectedStatus === 'All'"
            (click)="filterByStatus('All')"
          >
            All
          </button>
          <button 
            class="filter-btn" 
            [class.active]="selectedStatus === BoxStatus.NotStarted"
            (click)="filterByStatus(BoxStatus.NotStarted)"
          >
            Not Started
          </button>
          <button 
            class="filter-btn" 
            [class.active]="selectedStatus === BoxStatus.InProgress"
            (click)="filterByStatus(BoxStatus.InProgress)"
          >
            In Progress
          </button>
          <button 
            class="filter-btn" 
            [class.active]="selectedStatus === BoxStatus.Completed"
            (click)="filterByStatus(BoxStatus.Completed)"
          >
            Completed
          </button>
          <button 
            class="filter-btn" 
            [class.active]="selectedStatus === BoxStatus.Dispatched"
            (click)="filterByStatus(BoxStatus.Dispatched)"
          >
            Dispatched
          </button>
        </div>
      </div>

      <!-- Filter Dropdowns Row -->
      <div class="filters-row">
        <div class="filter-group">
          <label for="boxSubTypeFilter" class="filter-label">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="5" y="5" width="14" height="14" rx="1" ry="1"/>
            </svg>
            Sub Type:
          </label>
          <select id="boxSubTypeFilter" [(ngModel)]="selectedBoxSubTypeFilter" (change)="applyFilters()" class="filter-select">
            <option value="">All Sub Types</option>
            <option *ngFor="let subType of availableBoxSubTypes" [value]="subType">{{ subType }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="boxBuildingFilter" class="filter-label">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            </svg>
            Building:
          </label>
          <select id="boxBuildingFilter" [(ngModel)]="selectedBoxBuildingFilter" (change)="applyFilters()" class="filter-select">
            <option value="">All Buildings</option>
            <option *ngFor="let building of availableBoxBuildings" [value]="building">{{ building }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="boxFloorFilter" class="filter-label">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 3h18v4H3z"/>
              <path d="M3 11h18v4H3z"/>
              <path d="M3 19h18v2H3z"/>
            </svg>
            Floor:
          </label>
          <select id="boxFloorFilter" [(ngModel)]="selectedBoxFloorFilter" (change)="applyFilters()" class="filter-select">
            <option value="">All Floors</option>
            <option *ngFor="let floor of availableBoxFloors" [value]="floor">{{ floor }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="boxZoneFilter" class="filter-label">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            Zone:
          </label>
          <select id="boxZoneFilter" [(ngModel)]="selectedBoxZoneFilter" (change)="applyFilters()" class="filter-select">
            <option value="">All Zones</option>
            <option *ngFor="let zone of availableBoxZones" [value]="zone">{{ zone }}</option>
          </select>
        </div>

        <button 
          class="btn btn-clear-filters" 
          *ngIf="hasActiveBoxFilters()"
          (click)="clearBoxFilters()"
          title="Clear all filters"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
          Clear Filters
        </button>
      </div>
      
      <div class="results-count" *ngIf="searchControl.value || hasActiveBoxFilters()">
        <span class="count-badge">{{ filteredBoxes.length }} of {{ boxes.length }} boxes</span>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <div class="spinner"></div>
      <p>Loading boxes...</p>
    </div>

    <!-- Error State -->
    <div class="error-container" *ngIf="error && !loading">
      <p class="error-message">{{ error }}</p>
      <button class="btn btn-primary" (click)="loadBoxes()">Retry</button>
    </div>

    <!-- Box Types Grid -->
    <div class="boxes-grid" *ngIf="showBoxTypes && !loading && !error">
      <!-- Empty State - No box types at all -->
      <div class="empty-state" *ngIf="boxTypes.length === 0">
        <div class="empty-state-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
            <polyline points="7.5 4.21 12 6.81 16.5 4.21"/>
            <polyline points="7.5 19.79 7.5 14.6 3 12"/>
            <polyline points="21 12 16.5 14.6 16.5 19.79"/>
            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
            <line x1="12" y1="22.08" x2="12" y2="12"/>
          </svg>
        </div>
        <div class="empty-state-content">
          <h3 class="empty-state-title">No Boxes Yet</h3>
          <p class="empty-state-description">Start building your project by creating your first box. Boxes help you organize and track different components of your project.</p>
          <button class="btn btn-primary btn-create" (click)="createBox()" *ngIf="canCreate">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            Create Your First Box
          </button>
        </div>
      </div>

      <!-- Empty State - No filtered results -->
      <div class="empty-state" *ngIf="boxTypes.length > 0 && filteredBoxTypes.length === 0">
        <div class="empty-state-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
        </div>
        <div class="empty-state-content">
          <h3 class="empty-state-title">No Box Types Found</h3>
          <p class="empty-state-description">No box types match your search criteria. Try adjusting your search term.</p>
        </div>
      </div>

      <!-- Box Type Cards -->
      <div class="box-card" *ngFor="let boxType of filteredBoxTypes" (click)="viewBoxType(boxType.boxType)">
        <div class="card-header">
          <div class="box-info">
            <h3 class="box-name">{{ boxType.boxType }}</h3>
            <span class="box-code">{{ boxType.boxCount }} {{ boxType.boxCount === 1 ? 'box' : 'boxes' }}</span>
          </div>
        </div>

        <div class="card-body">
          <div class="box-progress">
            <div class="progress-header">
              <span class="progress-label">Overall Progress</span>
              <span class="progress-value">{{ roundToOneDecimal(boxType.overallProgress) }}%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="boxType.overallProgress"></div>
            </div>
          </div>

          <div class="box-stats">
            <div class="stat-item">
              <span class="stat-label">Total Boxes</span>
              <span class="stat-value">{{ boxType.boxCount }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Progress</span>
              <span class="stat-value">{{ roundToOneDecimal(boxType.overallProgress) }}%</span>
            </div>
          </div>

          <!-- Sub Types Breakdown -->
          <div class="sub-types-section" *ngIf="boxType.subTypes && boxType.subTypes.length > 0">
            <h4 class="sub-types-title">Sub Types</h4>
            <div class="sub-type-list">
              <div 
                class="sub-type-item clickable" 
                *ngFor="let subType of boxType.subTypes"
                (click)="viewBoxSubType(boxType.boxType, subType.subTypeAbbreviation || subType.subTypeName, $event)"
                title="Click to view {{ subType.subTypeAbbreviation || subType.subTypeName }} boxes"
              >
                <div class="sub-type-info">
                  <span class="sub-type-name">{{ subType.subTypeAbbreviation || subType.subTypeName }}</span>
                </div>
                <div class="sub-type-stats">
                  <span class="sub-type-count">{{ subType.boxCount }} {{ subType.boxCount === 1 ? 'box' : 'boxes' }}</span>
                  <span class="sub-type-progress">{{ roundToOneDecimal(subType.progress) }}%</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card-footer">
          <button class="btn-text" (click)="viewBoxType(boxType.boxType); $event.stopPropagation()">
            View Boxes
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="5" y1="12" x2="19" y2="12"/>
              <polyline points="12 5 19 12 12 19"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Boxes Grid -->
    <div class="boxes-grid" *ngIf="!showBoxTypes && !loading && !error">
      <!-- Empty State -->
      <div class="empty-state" *ngIf="filteredBoxes.length === 0">
        <div class="empty-state-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
            <polyline points="7.5 4.21 12 6.81 16.5 4.21"/>
            <polyline points="7.5 19.79 7.5 14.6 3 12"/>
            <polyline points="21 12 16.5 14.6 16.5 19.79"/>
            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
            <line x1="12" y1="22.08" x2="12" y2="12"/>
          </svg>
        </div>
        <div class="empty-state-content">
          <h3 class="empty-state-title">{{ boxes.length === 0 ? 'No Boxes in This Type' : 'No Results Found' }}</h3>
          <p class="empty-state-description">{{ boxes.length === 0 ? 'Start organizing this box type by adding boxes. Each box can contain multiple activities and track progress.' : 'Try adjusting your search or filter criteria to find what you\'re looking for.' }}</p>
          <button class="btn btn-primary btn-create" (click)="createBox()" *ngIf="canCreate && boxes.length === 0">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            Add Box
          </button>
        </div>
      </div>

      <!-- Box Cards -->
      <div class="box-card" *ngFor="let box of filteredBoxes" (click)="viewBox(box.id)">
        <div class="card-header">
          <div class="box-info">
            <h3 class="box-name">
              {{ box.name || box.code }}
              <span class="box-number" *ngIf="box.boxNumber">#{{ box.boxNumber }}</span>
            </h3>
            <span class="box-code">{{ box.code }}</span>
          </div>
          <span class="badge" [ngClass]="getStatusClass(box.status)">
            {{ getStatusLabel(box.status) }}
          </span>
        </div>

        <div class="card-body">
          <div class="box-details">
            <div class="detail-item" *ngIf="getBoxTypeFromTag(box) || box.boxTypeName || box.type">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              </svg>
              <span>
                {{ getBoxTypeFromTag(box) || box.boxTypeName || box.type }}
                <span *ngIf="getBoxSubTypeFromTag(box)">
                  / {{ getBoxSubTypeFromTag(box) }}
                </span>
              </span>
            </div>
            <div class="detail-item" *ngIf="box.assignedTeam">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
              <span>{{ box.assignedTeam }}</span>
            </div>
            <div class="detail-item" *ngIf="box.bay || box.row || box.position">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
              </svg>
              <span>
                <span *ngIf="box.bay">Bay: {{ box.bay }}</span>
                <span *ngIf="box.bay && box.row"> • </span>
                <span *ngIf="box.row">Row: {{ box.row }}</span>
                <span *ngIf="(box.bay || box.row) && box.position"> • </span>
                <span *ngIf="box.position">Pos: {{ box.position }}</span>
              </span>
            </div>
            <div class="detail-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10 9 9 9 8 9"/>
              </svg>
              <span>{{ getDrawingsCount(box) }} {{ getDrawingsCount(box) === 1 ? 'Drawing' : 'Drawings' }}</span>
            </div>
          </div>

          <div class="box-progress">
            <div class="progress-header">
              <span class="progress-label">Progress</span>
              <span class="progress-value">{{ roundToOneDecimal(box.progress) }}%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="box.progress"></div>
            </div>
          </div>

         
        </div>

        <div class="card-footer">
          <div class="footer-buttons">
            <button class="btn-text btn-view" (click)="viewBox(box.id); $event.stopPropagation()">
              View Details
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="5" y1="12" x2="19" y2="12"/>
                <polyline points="12 5 19 12 12 19"/>
              </svg>
            </button>
            <button class="btn-text btn-duplicate" (click)="duplicateBox(box); $event.stopPropagation()" *ngIf="canCreate">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
              </svg>
              Duplicate
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Duplicate Confirmation Modal -->
<div class="modal-backdrop" *ngIf="showDuplicateConfirm" (click)="cancelDuplicate()">
  <div class="confirm-modal" (click)="$event.stopPropagation()">
    <div class="modal-icon-wrapper">
      <div class="modal-icon duplicate">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
        </svg>
      </div>
    </div>
    <div class="modal-content">
      <h3>Duplicate box "{{ boxToDuplicate?.name || boxToDuplicate?.code }}"?</h3>
      <p>This will create a new box with:</p>
      <ul class="modal-checklist">
        <li>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M20 6L9 17l-5-5"/>
          </svg>
          All properties copied
        </li>
        <li>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M20 6L9 17l-5-5"/>
          </svg>
          New serial number generated
        </li>
        <li>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M20 6L9 17l-5-5"/>
          </svg>
          Activities included
        </li>
       
      </ul>
      <p class="modal-note">Status will be reset to "Not Started"</p>
    </div>
    <div class="modal-actions">
      <button class="btn btn-outline-secondary" type="button" (click)="cancelDuplicate()" [disabled]="duplicating">
        Cancel
      </button>
      <button class="btn btn-primary" type="button" (click)="confirmDuplicate()" [disabled]="duplicating">
        <span class="spinner small" *ngIf="duplicating"></span>
        <span *ngIf="!duplicating">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
          </svg>
          Duplicate Box
        </span>
        <span *ngIf="duplicating">Duplicating...</span>
      </button>
    </div>
  </div>
</div>
