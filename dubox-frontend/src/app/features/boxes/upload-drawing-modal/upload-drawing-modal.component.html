<div class="modal-overlay" *ngIf="isOpen" (click)="close()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Upload Drawing</h2>
      <button class="close-btn" (click)="close()" type="button" [disabled]="isSubmitting">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <!-- Box Info -->
      <div class="box-info" *ngIf="boxName">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
          <line x1="9" y1="3" x2="9" y2="21"/>
          <line x1="3" y1="9" x2="21" y2="9"/>
        </svg>
        <span>{{ boxName }}</span>
      </div>

      <!-- Alert Messages -->
      <div class="alert alert-danger" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>
      <div class="alert alert-success" *ngIf="successMessage">
        {{ successMessage }}
      </div>

      <!-- Form -->
      <form (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label>Upload Method</label>
          <p class="form-hint">Add drawing from URL or upload PDF/DWG file</p>
          
          <!-- Input Method Tabs -->
          <div class="input-method-tabs">
            <button 
              type="button"
              class="tab-button"
              [class.active]="inputMethod === 'url'"
              (click)="setInputMethod('url')"
              [disabled]="isSubmitting"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
              </svg>
              URL
            </button>
            <button 
              type="button"
              class="tab-button"
              [class.active]="inputMethod === 'file'"
              (click)="openFileInput()"
              [disabled]="isSubmitting"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              Upload File
            </button>
          </div>

          <!-- URL Input -->
          <div *ngIf="inputMethod === 'url'" class="input-content">
            <div class="url-input-group">
              <div class="url-input-wrapper">
                <svg class="url-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                </svg>
                <input
                  type="url"
                  class="form-control"
                  placeholder="Enter drawing URL (e.g., https://example.com/drawing.pdf)"
                  [(ngModel)]="drawingUrl"
                  name="drawingUrl"
                  [disabled]="isSubmitting"
                  required
                />
              </div>
            </div>
          </div>

          <!-- File Upload Input (hidden) -->
          <input
            id="drawing-file-input"
            type="file"
            accept=".pdf,.dwg"
            style="display: none"
            (change)="onFileSelected($event)"
            [disabled]="isSubmitting"
          />

          <!-- File Preview -->
          <div *ngIf="inputMethod === 'file' && filePreview" class="file-preview">
            <div class="file-preview-card">
              <div class="file-icon">
                <svg *ngIf="filePreview.name.endsWith('.pdf')" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                  <line x1="16" y1="13" x2="8" y2="13"/>
                  <line x1="16" y1="17" x2="8" y2="17"/>
                  <polyline points="10 9 9 9 8 9"/>
                </svg>
                <svg *ngIf="filePreview.name.endsWith('.dwg')" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                </svg>
              </div>
              <div class="file-info">
                <div class="file-name" [title]="filePreview.name">{{ filePreview.name }}</div>
                <div class="file-size">{{ formatFileSize(filePreview.size) }}</div>
              </div>
              <button 
                type="button" 
                class="remove-file-btn" 
                (click)="removeFile()"
                [disabled]="isSubmitting"
                title="Remove file"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <line x1="18" y1="6" x2="6" y2="18"/>
                  <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- File Upload Placeholder -->
          <div *ngIf="inputMethod === 'file' && !filePreview" class="file-upload-placeholder">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="17 8 12 3 7 8"/>
              <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
            <p>Click "Upload File" to select a PDF or DWG file</p>
            <small>Maximum file size: 50 MB</small>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="close()" [disabled]="isSubmitting">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="!canSubmit()">
            <span *ngIf="!isSubmitting">Upload Drawing</span>
            <span *ngIf="isSubmitting">Uploading...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

