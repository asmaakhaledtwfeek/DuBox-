<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="page-container">
  <div class="page-content">
    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <div class="spinner"></div>
      <p>Loading materials...</p>
    </div>

    <!-- Error State -->
    <div class="error-container" *ngIf="error && !loading">
      <p class="error-message">{{ error }}</p>
      <button class="btn btn-primary" (click)="loadMaterials()">Retry</button>
    </div>

    <!-- Dashboard Content -->
    <div *ngIf="!loading && !error">
      <!-- Dashboard Header -->
      <div class="dashboard-header">
        <div class="header-info">
          <h1 class="dashboard-title">Materials Dashboard</h1>
          <div class="dashboard-meta">
            <span class="meta-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 7h-4M4 7h4m0 0V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m-6 0h6m-6 0v10m6-10v10"/>
              </svg>
              {{ stats.total }} Total Materials
            </span>
            <span class="meta-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
              </svg>
              {{ stats.active }} Active
            </span>
          </div>
        </div>
        <div class="header-actions">
          <button 
            *ngIf="canCreate"
            class="btn btn-primary"
            (click)="createMaterial()"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5v14M5 12h14"/>
            </svg>
            Create Material
          </button>
        </div>
      </div>

      <!-- KPI Cards -->
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-icon" style="background: rgba(46, 125, 50, 0.1); color: var(--primary-color);">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 7h-4M4 7h4m0 0V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m-6 0h6m-6 0v10m6-10v10"/>
            </svg>
          </div>
          <div class="kpi-content">
            <div class="kpi-value">{{ stats.total }}</div>
            <div class="kpi-label">Total Materials</div>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success-color);">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
            </svg>
          </div>
          <div class="kpi-content">
            <div class="kpi-value">{{ stats.active }}</div>
            <div class="kpi-label">Active Materials</div>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--warning-color);">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 9v4M12 17h.01M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"/>
            </svg>
          </div>
          <div class="kpi-content">
            <div class="kpi-value">{{ stats.lowStock }}</div>
            <div class="kpi-label">Low Stock</div>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon" style="background: rgba(239, 68, 68, 0.1); color: var(--error-color);">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4M12 17h.01"/>
            </svg>
          </div>
          <div class="kpi-content">
            <div class="kpi-value">{{ stats.needsReorder }}</div>
            <div class="kpi-label">Needs Reorder</div>
          </div>
        </div>
      </div>

      <!-- Filters Section -->
      <div class="filters-card card">
        <div class="filters-content">
          <div class="search-box">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
            <input 
              type="text" 
              [formControl]="searchControl"
              placeholder="Search by code, name, category, or supplier..."
              class="search-input"
            />
          </div>

          <div class="filter-controls">
            <select 
              class="filter-select"
              [(ngModel)]="selectedCategory"
              (change)="onCategoryChange()"
              [ngModelOptions]="{standalone: true}"
            >
              <option value="All">All Categories</option>
              <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
            </select>

            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [(ngModel)]="showLowStockOnly"
                (change)="onLowStockToggle()"
                [ngModelOptions]="{standalone: true}"
              />
              <span>Show Low Stock Only</span>
            </label>
          </div>
        </div>
      </div>

      <!-- Materials Table -->
      <div class="materials-table-card card">
        <h2 class="card-title">Materials List</h2>
        <div class="table-container">
          <table class="materials-table">
          <thead>
            <tr>
              <th>Code</th>
              <th>Name</th>
              <th>Category</th>
              <th>Unit</th>
              <th>Current Stock</th>
              <th>Min Stock</th>
              <th>Reorder Level</th>
              <th>Status</th>
              <th>Supplier</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let material of filteredMaterials" [class.inactive]="!material.isActive">
              <td class="code-cell">
                <strong>{{ material.materialCode }}</strong>
              </td>
              <td class="name-cell">{{ material.materialName }}</td>
              <td>{{ material.materialCategory || '-' }}</td>
              <td>{{ material.unit || '-' }}</td>
              <td class="stock-cell">
                <span [class]="getStockStatusClass(material)">
                  {{ material.currentStock ?? 0 }}
                </span>
              </td>
              <td>{{ material.minimumStock ?? '-' }}</td>
              <td>{{ material.reorderLevel ?? '-' }}</td>
              <td>
                <span class="status-badge" [class]="getStockStatusClass(material)">
                  {{ getStockStatusText(material) }}
                </span>
              </td>
              <td>{{ material.supplierName || '-' }}</td>
              <td class="actions-cell">
                <button 
                  class="btn-icon"
                  (click)="viewDetails(material.materialId)"
                  title="View Details"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                </button>
                <button 
                  *ngIf="canEdit"
                  class="btn-icon"
                  (click)="editMaterial(material.materialId)"
                  title="Edit"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                  </svg>
                </button>
              </td>
            </tr>
          </tbody>
        </table>

          <!-- Empty State -->
          <div *ngIf="filteredMaterials.length === 0" class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M20 7h-4M4 7h4m0 0V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m-6 0h6m-6 0v10m6-10v10"/>
            </svg>
            <h3>No Materials Found</h3>
            <p>{{ materials.length === 0 ? 'Create your first material to get started.' : 'No materials match your filters.' }}</p>
            <button 
              *ngIf="canCreate && materials.length === 0"
              class="btn btn-primary"
              (click)="createMaterial()"
            >
              Create Material
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

