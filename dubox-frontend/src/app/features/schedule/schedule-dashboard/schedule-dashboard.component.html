<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="page-container">
  <div class="page-content">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-left">
        <h1 class="page-title">Schedule Activities</h1>
        <p class="page-subtitle">Manage planned activities with team and material assignments</p>
      </div>
      <div class="header-right">
        <!-- View Selector -->
        <div class="view-selector">
          <button class="btn-view" (click)="toggleViewDropdown($event)">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect *ngIf="currentView === 'card'" x="3" y="3" width="7" height="7"/>
              <rect *ngIf="currentView === 'card'" x="14" y="3" width="7" height="7"/>
              <rect *ngIf="currentView === 'card'" x="3" y="14" width="7" height="7"/>
              <rect *ngIf="currentView === 'card'" x="14" y="14" width="7" height="7"/>
              <line *ngIf="currentView === 'list'" x1="8" y1="6" x2="21" y2="6"/>
              <line *ngIf="currentView === 'list'" x1="8" y1="12" x2="21" y2="12"/>
              <line *ngIf="currentView === 'list'" x1="8" y1="18" x2="21" y2="18"/>
              <line *ngIf="currentView === 'list'" x1="3" y1="6" x2="3.01" y2="6"/>
              <line *ngIf="currentView === 'list'" x1="3" y1="12" x2="3.01" y2="12"/>
              <line *ngIf="currentView === 'list'" x1="3" y1="18" x2="3.01" y2="18"/>
              <line *ngIf="currentView === 'detailed'" x1="4" y1="6" x2="20" y2="6"/>
              <line *ngIf="currentView === 'detailed'" x1="4" y1="12" x2="20" y2="12"/>
              <line *ngIf="currentView === 'detailed'" x1="4" y1="18" x2="20" y2="18"/>
              <line *ngIf="currentView === 'detailed'" x1="4" y1="2" x2="4" y2="22"/>
              <line *ngIf="currentView === 'detailed'" x1="12" y1="2" x2="12" y2="22"/>
            </svg>
            View
            <svg class="chevron" [class.rotated]="showViewDropdown" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </button>
          
          <div class="view-dropdown" *ngIf="showViewDropdown">
            <button class="view-option" [class.active]="currentView === 'card'" (click)="setView('card')">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"/>
                <rect x="14" y="3" width="7" height="7"/>
                <rect x="3" y="14" width="7" height="7"/>
                <rect x="14" y="14" width="7" height="7"/>
              </svg>
              <span>Card View</span>
              <svg *ngIf="currentView === 'card'" class="checkmark" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </button>
            <button class="view-option" [class.active]="currentView === 'list'" (click)="setView('list')">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="8" y1="6" x2="21" y2="6"/>
                <line x1="8" y1="12" x2="21" y2="12"/>
                <line x1="8" y1="18" x2="21" y2="18"/>
                <line x1="3" y1="6" x2="3.01" y2="6"/>
                <line x1="3" y1="12" x2="3.01" y2="12"/>
                <line x1="3" y1="18" x2="3.01" y2="18"/>
              </svg>
              <span>List View</span>
              <svg *ngIf="currentView === 'list'" class="checkmark" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </button>
            <button class="view-option" [class.active]="currentView === 'detailed'" (click)="setView('detailed')">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="4" y1="6" x2="20" y2="6"/>
                <line x1="4" y1="12" x2="20" y2="12"/>
                <line x1="4" y1="18" x2="20" y2="18"/>
                <line x1="4" y1="2" x2="4" y2="22"/>
                <line x1="12" y1="2" x2="12" y2="22"/>
              </svg>
              <span>Detailed View</span>
              <svg *ngIf="currentView === 'detailed'" class="checkmark" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </button>
          </div>
        </div>

        <button class="btn-primary" (click)="openCreateForm()" [disabled]="!selectedProject">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Create Activity
        </button>
      </div>
    </div>

    <!-- Project Selection Section -->
    <div class="project-selection-section">
      <div class="selection-header">
        <div class="selection-controls">
          <div class="form-group">
            <label for="projectSelect">Project Name</label>
            <select 
              id="projectSelect" 
              [(ngModel)]="selectedProject" 
              (ngModelChange)="onProjectSelect($event)"
              class="filter-select project-select">
              <option [ngValue]="null">Select a project...</option>
              <option *ngFor="let project of projects" [ngValue]="project">
                {{ project.projectName }}
              </option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="projectCodeSelect">Project Number</label>
            <select 
              id="projectCodeSelect" 
              [(ngModel)]="selectedProject" 
              (ngModelChange)="onProjectSelect($event)"
              class="filter-select project-select">
              <option [ngValue]="null">Select a project number...</option>
              <option *ngFor="let project of projects" [ngValue]="project">
                {{ project.projectCode }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Project Details -->
      <div *ngIf="selectedProject" class="project-details-card">
        <h3>Project Details</h3>
        <div class="project-info-grid">
          <div class="info-item">
            <span class="info-label">Project:</span>
            <span class="info-value">{{ selectedProject.projectName }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Code:</span>
            <span class="info-value">{{ selectedProject.projectCode }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Client:</span>
            <span class="info-value">{{ selectedProject.clientName || 'N/A' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Status:</span>
            <span class="status-badge" [class]="selectedProject.status?.toLowerCase()">
              {{ selectedProject.status }}
            </span>
          </div>
          <div class="info-item" *ngIf="activities.length > 0">
            <span class="info-label">Total Activities:</span>
            <span class="info-value">{{ activities.length }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- No Project Selected State -->
    <div *ngIf="!selectedProject" class="empty-state">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2"/>
        <path d="M3 9h18M9 21V9"/>
      </svg>
      <h3>Select a Project</h3>
      <p>Choose a project from the dropdown above to view and manage its schedule activities</p>
    </div>

    <!-- Loading -->
    <div *ngIf="selectedProject && loading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading activities...</p>
    </div>

    <!-- Error -->
    <div *ngIf="selectedProject && error && !loading" class="error-state">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <h3>{{ error }}</h3>
      <button class="btn-primary" (click)="loadActivities()">Retry</button>
    </div>

    <!-- Activities List -->
    <div *ngIf="selectedProject && !loading && !error" class="activities-container">
      <div *ngIf="activities.length === 0" class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
        <h2>No Activities Yet</h2>
        <p>Create your first schedule activity for this project</p>
        <button class="btn-primary" (click)="openCreateForm()">Create Activity</button>
      </div>

      <!-- Card/Grid View -->
      <div *ngIf="activities.length > 0 && currentView === 'card'" class="activities-grid">
        <div *ngFor="let activity of activities" class="activity-card">
          <div class="activity-header">
            <div class="activity-title">
              <h3>{{ activity.activityName }}</h3>
              <span class="activity-code">{{ activity.activityCode }}</span>
            </div>
            <span class="status-badge" [ngClass]="getStatusClass(activity.status)">
              {{ activity.status }}
            </span>
          </div>

          <div class="activity-body">
            <div class="activity-dates">
              <div class="date-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <polyline points="12 6 12 12 16 14"/>
                </svg>
                <span>Start: {{ activity.plannedStartDate | date:'short' }}</span>
              </div>
              <div class="date-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <polyline points="12 6 12 12 16 14"/>
                </svg>
                <span>Finish: {{ activity.plannedFinishDate | date:'short' }}</span>
              </div>
            </div>

            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="activity.percentComplete"></div>
            </div>
            <span class="progress-text">{{ activity.percentComplete }}% Complete</span>

            <div class="activity-stats">
              <div class="stat-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                </svg>
                <span>{{ activity.teamCount }} Teams</span>
              </div>
              <div class="stat-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 7h-4M4 7h4m0 0V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m-6 0h6m-6 0v10m6-10v10"/>
                </svg>
                <span>{{ activity.materialCount }} Materials</span>
              </div>
            </div>
          </div>

          <div class="activity-actions">
            <button class="btn-secondary" (click)="openAssignTeamModal(activity.scheduleActivityId)">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="8.5" cy="7" r="4"/>
                <line x1="20" y1="8" x2="20" y2="14"/>
                <line x1="23" y1="11" x2="17" y2="11"/>
              </svg>
              Assign Team
            </button>
            <button class="btn-secondary" (click)="openAssignMaterialModal(activity.scheduleActivityId)">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
              Assign Material
            </button>
          </div>
        </div>
      </div>

      <!-- List View -->
      <div *ngIf="activities.length > 0 && currentView === 'list'" class="activities-list">
        <div *ngFor="let activity of activities" class="activity-list-item">
          <div class="list-item-main">
            <div class="list-item-title">
              <h3>{{ activity.activityName }}</h3>
              <span class="activity-code">{{ activity.activityCode }}</span>
            </div>
            <span class="status-badge" [ngClass]="getStatusClass(activity.status)">
              {{ activity.status }}
            </span>
          </div>
          <div class="list-item-details">
            <div class="list-detail">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              <span>{{ activity.plannedStartDate | date:'short' }} - {{ activity.plannedFinishDate | date:'short' }}</span>
            </div>
            <div class="list-detail">
              <div class="mini-progress">
                <div class="mini-progress-fill" [style.width.%]="activity.percentComplete"></div>
              </div>
              <span>{{ activity.percentComplete }}%</span>
            </div>
            <div class="list-detail">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
              </svg>
              <span>{{ activity.teamCount }}</span>
            </div>
            <div class="list-detail">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 7h-4M4 7h4m0 0V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m-6 0h6m-6 0v10m6-10v10"/>
              </svg>
              <span>{{ activity.materialCount }}</span>
            </div>
          </div>
          <div class="list-item-actions">
            <button class="btn-icon" (click)="openAssignTeamModal(activity.scheduleActivityId)" title="Assign Team">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="8.5" cy="7" r="4"/>
                <line x1="20" y1="8" x2="20" y2="14"/>
                <line x1="23" y1="11" x2="17" y2="11"/>
              </svg>
            </button>
            <button class="btn-icon" (click)="openAssignMaterialModal(activity.scheduleActivityId)" title="Assign Material">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Detailed View (Table) -->
      <div *ngIf="activities.length > 0 && currentView === 'detailed'" class="activities-table-container">
        <table class="activities-table">
          <thead>
            <tr>
              <th>Activity Name</th>
              <th>Code</th>
              <th>Status</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Progress</th>
              <th>Teams</th>
              <th>Materials</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let activity of activities">
              <td class="activity-name-cell">
                <strong>{{ activity.activityName }}</strong>
              </td>
              <td>
                <span class="activity-code-inline">{{ activity.activityCode }}</span>
              </td>
              <td>
                <span class="status-badge" [ngClass]="getStatusClass(activity.status)">
                  {{ activity.status }}
                </span>
              </td>
              <td class="date-cell">{{ activity.plannedStartDate | date:'short' }}</td>
              <td class="date-cell">{{ activity.plannedFinishDate | date:'short' }}</td>
              <td class="progress-cell">
                <div class="table-progress">
                  <div class="table-progress-bar">
                    <div class="table-progress-fill" [style.width.%]="activity.percentComplete"></div>
                  </div>
                  <span class="table-progress-text">{{ activity.percentComplete }}%</span>
                </div>
              </td>
              <td class="count-cell">{{ activity.teamCount }}</td>
              <td class="count-cell">{{ activity.materialCount }}</td>
              <td class="actions-cell">
                <div class="table-actions">
                  <button class="btn-icon" (click)="openAssignTeamModal(activity.scheduleActivityId)" title="Assign Team">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                      <circle cx="8.5" cy="7" r="4"/>
                      <line x1="20" y1="8" x2="20" y2="14"/>
                      <line x1="23" y1="11" x2="17" y2="11"/>
                    </svg>
                  </button>
                  <button class="btn-icon" (click)="openAssignMaterialModal(activity.scheduleActivityId)" title="Assign Material">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="12" y1="5" x2="12" y2="19"/>
                      <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Create Activity Modal -->
<div *ngIf="showCreateForm" class="modal-overlay" (click)="closeCreateForm()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Create Schedule Activity</h2>
      <button class="btn-close" (click)="closeCreateForm()" [disabled]="creatingActivity">×</button>
    </div>
    <div class="modal-body">
      <!-- Error Message -->
      <div *ngIf="createActivityError" class="error-message" style="background-color: #fee; border: 1px solid #fcc; color: #c33; padding: 12px; border-radius: 6px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink: 0;">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span>{{ createActivityError }}</span>
      </div>

      <div class="form-group">
        <label>Activity Name *</label>
        <input type="text" [(ngModel)]="newActivity.activityName" placeholder="Enter activity name" [disabled]="creatingActivity" />
      </div>
      <div class="form-group">
        <label>Activity Code *</label>
        <input type="text" [(ngModel)]="newActivity.activityCode" placeholder="Enter activity code" [disabled]="creatingActivity" />
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea [(ngModel)]="newActivity.description" placeholder="Enter description" rows="3" [disabled]="creatingActivity"></textarea>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Planned Start Date *</label>
          <input type="datetime-local" [(ngModel)]="newActivity.plannedStartDate" [disabled]="creatingActivity" />
        </div>
        <div class="form-group">
          <label>Planned Finish Date *</label>
          <input type="datetime-local" [(ngModel)]="newActivity.plannedFinishDate" [disabled]="creatingActivity" />
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeCreateForm()" [disabled]="creatingActivity">Cancel</button>
      <button class="btn-primary" (click)="createActivity()" [disabled]="creatingActivity">
        <span *ngIf="creatingActivity">Creating...</span>
        <span *ngIf="!creatingActivity">Create Activity</span>
      </button>
    </div>
  </div>
</div>

<!-- Assign Team Modal -->
<div *ngIf="showAssignTeamModal" class="modal-overlay" (click)="closeAssignTeamModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Assign Team</h2>
      <button class="btn-close" (click)="closeAssignTeamModal()" [disabled]="assigningTeam">×</button>
    </div>
    <div class="modal-body">
      <!-- Error Message -->
      <div *ngIf="assignTeamError" class="error-message" style="background-color: #fee; border: 1px solid #fcc; color: #c33; padding: 12px; border-radius: 6px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink: 0;">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span>{{ assignTeamError }}</span>
      </div>

      <div class="form-group">
        <label>Select Team *</label>
        <select [(ngModel)]="selectedTeamId" (change)="onTeamChange()" [disabled]="loadingTeams || assigningTeam">
          <option value="">-- Select a team --</option>
          <option *ngFor="let team of teams" [value]="team.teamId">
            {{ team.teamName }} ({{ team.teamCode }})
          </option>
        </select>
        <div *ngIf="loadingTeams" style="font-size: 12px; color: #64748b; margin-top: 4px;">
          Loading teams...
        </div>
        <small *ngIf="!loadingTeams && teams.length === 0" style="color: #94a3b8; margin-top: 4px; display: block;">
          No teams available. Please contact your administrator.
        </small>
      </div>
      
      <div class="form-group" *ngIf="selectedTeamId">
        <label>Select Team Member <span style="color: #94a3b8; font-weight: normal;">(Optional)</span></label>
        <select [(ngModel)]="selectedMemberId" [disabled]="loadingMembers || assigningTeam">
          <option value="">-- Select a member (Optional) --</option>
          <option *ngFor="let member of teamMembers" [value]="member.teamMemberId">
            {{ member.employeeName || member.fullName || member.email }}
          </option>
        </select>
        <div *ngIf="loadingMembers" style="font-size: 12px; color: #64748b; margin-top: 4px;">
          Loading team members...
        </div>
        <small *ngIf="!loadingMembers && teamMembers.length === 0 && selectedTeamId" style="color: #94a3b8; margin-top: 4px; display: block;">
          No members available for this team.
        </small>
      </div>
      
      <div class="form-group">
        <label>Notes</label>
        <textarea [(ngModel)]="assignTeamNotes" placeholder="Add any notes" rows="3" [disabled]="assigningTeam"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeAssignTeamModal()" [disabled]="assigningTeam">Cancel</button>
      <button class="btn-primary" (click)="assignTeam()" [disabled]="assigningTeam">
        <span *ngIf="assigningTeam">Assigning...</span>
        <span *ngIf="!assigningTeam">Assign Team</span>
      </button>
    </div>
  </div>
</div>

<!-- Assign Material Modal -->
<div *ngIf="showAssignMaterialModal" class="modal-overlay" (click)="closeAssignMaterialModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Assign Material</h2>
      <button class="btn-close" (click)="closeAssignMaterialModal()" [disabled]="assigningMaterial">×</button>
    </div>
    <div class="modal-body">
      <!-- Error Message -->
      <div *ngIf="assignMaterialError" class="error-message" style="background-color: #fee; border: 1px solid #fcc; color: #c33; padding: 12px; border-radius: 6px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink: 0;">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span>{{ assignMaterialError }}</span>
      </div>

      <div class="form-group">
        <label>Material Name *</label>
        <input type="text" [(ngModel)]="newMaterial.materialName" placeholder="Enter material name" [disabled]="assigningMaterial" />
      </div>
      <div class="form-group">
        <label>Material Code</label>
        <input type="text" [(ngModel)]="newMaterial.materialCode" placeholder="Enter material code" [disabled]="assigningMaterial" />
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Quantity *</label>
          <input type="number" [(ngModel)]="newMaterial.quantity" placeholder="0" min="0" step="0.01" [disabled]="assigningMaterial" />
        </div>
        <div class="form-group">
          <label>Unit</label>
          <input type="text" [(ngModel)]="newMaterial.unit" placeholder="e.g., m3, kg, pcs" [disabled]="assigningMaterial" />
        </div>
      </div>
      <div class="form-group">
        <label>Notes</label>
        <textarea [(ngModel)]="newMaterial.notes" placeholder="Add any notes" rows="3" [disabled]="assigningMaterial"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeAssignMaterialModal()" [disabled]="assigningMaterial">Cancel</button>
      <button class="btn-primary" (click)="assignMaterial()" [disabled]="assigningMaterial">
        <span *ngIf="assigningMaterial">Assigning...</span>
        <span *ngIf="!assigningMaterial">Assign Material</span>
      </button>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div *ngIf="showSuccessModal" class="modal-overlay" (click)="closeSuccessModal()">
  <div class="modal-content success-modal" (click)="$event.stopPropagation()" style="max-width: 400px;">
    <div class="modal-body" style="text-align: center; padding: 32px;">
      <div style="width: 64px; height: 64px; background-color: #dcfce7; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="3">
          <polyline points="20 6 9 17 4 12"/>
        </svg>
      </div>
      <h2 style="margin: 0 0 12px; color: #16a34a; font-size: 24px;">Success!</h2>
      <p style="color: #64748b; margin: 0 0 24px; font-size: 16px;">{{ successMessage }}</p>
      <button class="btn-primary" (click)="closeSuccessModal()" style="width: 100%; padding: 12px;">OK</button>
    </div>
  </div>
</div>

