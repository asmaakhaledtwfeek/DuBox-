<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="page-container">
  <div class="page-content">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading team information...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 8v4M12 16h.01"/>
      </svg>
      <p>{{ error }}</p>
      <button class="btn btn-secondary" (click)="onCancel()">Back to Team</button>
    </div>

    <!-- Form Content -->
    <div *ngIf="!loading && team" class="form-container">
      <!-- Page Header -->
      <div class="page-header">
        <div class="header-left">
          <button class="btn-back" (click)="onCancel()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="12" x2="5" y2="12"/>
              <polyline points="12 19 5 12 12 5"/>
            </svg>
            Back to Team
          </button>
          <div class="title-section">
            <h1 class="page-title">Add Members to Team</h1>
          </div>
          <p class="page-subtitle">{{ team.teamName }} ({{ team.teamCode }}) â€¢ {{ team.departmentName }}</p>
        </div>
      </div>

      <!-- Info Message -->
      <div class="info-message">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 16v-4M12 8h.01"/>
        </svg>
        <span>Only users from the same department ({{ team.departmentName }}) are available for selection.</span>
      </div>

      <!-- Success Message -->
      <div *ngIf="successMessage" class="success-message">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
        <span>{{ successMessage }}</span>
      </div>

      <!-- Error Message -->
      <div *ngIf="error && !loading" class="error-message">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span>{{ error }}</span>
      </div>

      <!-- Users List -->
      <div class="users-section">
        <div class="section-header">
          <h2 class="section-title">Available Users</h2>
          <span class="selection-count">{{ getSelectedCount() }} selected</span>
        </div>

        <div *ngIf="availableUsers.length === 0" class="empty-state">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75M13 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0z"/>
          </svg>
          <h3>No Users Available</h3>
          <p>No active users found in the {{ team.departmentName }} department.</p>
        </div>

        <div *ngIf="availableUsers.length > 0" class="users-grid">
          <div 
            *ngFor="let user of availableUsers" 
            class="user-card"
            [class.selected]="isUserSelected(user.userId)"
            (click)="toggleUserSelection(user.userId)"
          >
            <div class="user-checkbox">
              <input 
                type="checkbox" 
                [checked]="isUserSelected(user.userId)"
                (change)="toggleUserSelection(user.userId)"
                (click)="$event.stopPropagation()"
              />
            </div>
            <div class="user-avatar">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
            </div>
            <div class="user-info">
              <div class="user-name">{{ user.fullName || user.email }}</div>
              <div class="user-email">{{ user.email }}</div>
              <div class="user-department" *ngIf="user.department">{{ user.department }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="onCancel()"
          [disabled]="saving"
        >
          Cancel
        </button>
        <button 
          type="button" 
          class="btn btn-primary" 
          (click)="onSubmit()"
          [disabled]="saving || selectedUserIds.length === 0"
        >
          <span *ngIf="saving">Adding Members...</span>
          <span *ngIf="!saving">Add {{ getSelectedCount() }} Member(s)</span>
        </button>
      </div>
    </div>
  </div>
</div>


