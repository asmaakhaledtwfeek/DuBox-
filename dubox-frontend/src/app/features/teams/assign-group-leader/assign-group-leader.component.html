<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="page-container">
  <div class="page-content">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 8v4M12 16h.01"/>
      </svg>
      <p>{{ error }}</p>
      <button class="btn btn-secondary" (click)="goBack()">Go Back</button>
    </div>

    <!-- Main Content -->
    <div *ngIf="teamGroup && !loading" class="assign-leader-content">
      <!-- Page Header -->
      <div class="page-header">
        <div class="header-left">
          <button class="btn-back" (click)="goBack()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="12" x2="5" y2="12"/>
              <polyline points="12 19 5 12 12 5"/>
            </svg>
            Back to Group Details
          </button>

          <div class="title-section">
            <h1 class="page-title">{{ teamGroup.groupLeaderName ? 'Change' : 'Assign' }} Group Leader</h1>
            <p class="page-subtitle">
              Select a team member to assign as the leader of <strong>{{ teamGroup.groupTag }}</strong>
            </p>
          </div>
        </div>
      </div>

      <!-- Search Section -->
      <div class="search-section">
        <div class="search-input-wrapper">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="M21 21l-4.35-4.35"/>
          </svg>
          <input 
            type="text" 
            class="search-input" 
            placeholder="Search by name, employee code, or email..."
            [(ngModel)]="searchTerm"
            (input)="onSearch()"
          />
          <button 
            *ngIf="searchTerm" 
            class="clear-search"
            (click)="clearSearch()"
            type="button"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <div class="search-results-info" *ngIf="!loadingMembers">
          <span>{{ filteredMembers.length }} {{ filteredMembers.length === 1 ? 'member' : 'members' }} found</span>
        </div>
      </div>

      <!-- Loading Members -->
      <div *ngIf="loadingMembers" class="loading-members">
        <div class="spinner-small"></div>
        <span>Loading team members...</span>
      </div>

      <!-- Members List -->
      <div *ngIf="!loadingMembers && filteredMembers.length > 0" class="members-list-container">
        <div class="members-grid">
          <div 
            *ngFor="let member of filteredMembers" 
            class="member-card"
            [class.selected]="selectedMemberId === member.teamMemberId"
            (click)="selectedMemberId = member.teamMemberId"
          >
            <div class="member-radio">
              <input 
                type="radio" 
                [id]="'member-' + member.teamMemberId"
                name="groupLeader"
                [value]="member.teamMemberId"
                [(ngModel)]="selectedMemberId"
              />
              <span class="radio-custom"></span>
            </div>
            
            <div class="member-content">
              <div class="member-avatar">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
              </div>
              
              <div class="member-info">
                <div class="member-name">{{ member.employeeName || member.fullName || member.email }}</div>
                <div class="member-meta">
                  <span *ngIf="member.employeeCode" class="employee-code">{{ member.employeeCode }}</span>
                  <span *ngIf="member.employeeCode && member.email" class="separator">â€¢</span>
                  <span class="email">{{ member.email }}</span>
                </div>
                <div class="current-leader-badge" *ngIf="member.teamMemberId === teamGroup.groupLeaderId">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                  </svg>
                  Current Leader
                </div>
              </div>
            </div>

            <div class="selection-indicator">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loadingMembers && filteredMembers.length === 0" class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
        </svg>
        <h3>No Members Found</h3>
        <p *ngIf="searchTerm">Try adjusting your search terms</p>
        <p *ngIf="!searchTerm">No active team members available</p>
        <button *ngIf="searchTerm" class="btn btn-secondary" (click)="clearSearch()">Clear Search</button>
      </div>

      <!-- Error/Success Messages -->
      <div *ngIf="assignLeaderError" class="alert alert-error">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 8v4M12 16h.01"/>
        </svg>
        {{ assignLeaderError }}
      </div>

      <div *ngIf="assignLeaderSuccess" class="alert alert-success">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
        {{ assignLeaderSuccess }}
      </div>

      <!-- Fixed Action Bar -->
      <div class="action-bar">
        <div class="action-bar-content">
          <div class="selected-info" *ngIf="selectedMemberId">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            <span>Member selected</span>
          </div>
          <div class="action-buttons">
            <button class="btn btn-secondary" (click)="goBack()" [disabled]="assigningLeader">
              Cancel
            </button>
            <button 
              class="btn btn-primary" 
              (click)="onAssignLeader()" 
              [disabled]="!selectedMemberId || assigningLeader || loadingMembers"
            >
              <span *ngIf="!assigningLeader">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                {{ teamGroup.groupLeaderName ? 'Change Leader' : 'Assign Leader' }}
              </span>
              <span *ngIf="assigningLeader" class="loading-text">
                <div class="spinner-small"></div>
                Assigning...
              </span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

