<div class="edit-team-page">
  <app-header></app-header>
  <div class="page-container">
    <app-sidebar></app-sidebar>
    
    <main class="main-content">
      <div class="page-header">
        <h1 class="page-title">Edit Team</h1>
      </div>

      <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Loading team...</p>
      </div>

      <div *ngIf="!loading" class="form-container">
        <form [formGroup]="teamForm" (ngSubmit)="onSubmit()">
          <!-- Success Message -->
          <div *ngIf="successMessage" class="alert alert-success">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            {{ successMessage }}
          </div>

          <!-- Error Message -->
          <div *ngIf="error" class="alert alert-error">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 8v4M12 16h.01"/>
            </svg>
            {{ error }}
          </div>

          <!-- Form Section: Basic Information -->
          <div class="form-section">
            <div class="section-header">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
              <h3 class="section-title">Team Information</h3>
            </div>
            
            <div class="form-grid">
            <!-- Team Code -->
            <div class="form-group">
              <label for="teamCode">Team Code <span class="required">*</span></label>
              <div class="input-with-icon">
                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                  <line x1="9" y1="3" x2="9" y2="21"/>
                </svg>
                <input 
                  type="text" 
                  id="teamCode"
                  formControlName="teamCode"
                  class="form-control"
                  [class.invalid]="teamForm.get('teamCode')?.invalid && teamForm.get('teamCode')?.touched"
                  placeholder="e.g., TM-001"
                />
              </div>
              <div *ngIf="teamForm.get('teamCode')?.invalid && teamForm.get('teamCode')?.touched" class="error-text">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 8v4M12 16h.01"/>
                </svg>
                Team code is required
              </div>
            </div>

            <!-- Team Name -->
            <div class="form-group">
              <label for="teamName">Team Name <span class="required">*</span></label>
              <div class="input-with-icon">
                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                <input 
                  type="text" 
                  id="teamName"
                  formControlName="teamName"
                  class="form-control"
                  [class.invalid]="teamForm.get('teamName')?.invalid && teamForm.get('teamName')?.touched"
                  placeholder="e.g., Steel Fabrication Team"
                />
              </div>
              <div *ngIf="teamForm.get('teamName')?.invalid && teamForm.get('teamName')?.touched" class="error-text">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 8v4M12 16h.01"/>
                </svg>
                Team name is required
              </div>
            </div>

            <!-- Department -->
            <div class="form-group">
              <label for="departmentId">Department <span class="required">*</span></label>
              <div class="input-with-icon">
                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                  <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
                <select 
                  id="departmentId"
                  formControlName="departmentId"
                  class="form-control"
                  [class.invalid]="teamForm.get('departmentId')?.invalid && teamForm.get('departmentId')?.touched"
                  [disabled]="loadingDepartments || teamHasMembers"
                  [title]="teamHasMembers ? 'Cannot change department when team has members. Remove all members first.' : ''"
                >
                  <option value="">Select Department</option>
                  <option *ngFor="let dept of departments" [value]="dept.departmentId">{{ dept.departmentName }}</option>
                </select>
              </div>
              <div *ngIf="loadingDepartments" class="loading-text">
                <div class="spinner-tiny"></div>
                Loading departments...
              </div>
              <div *ngIf="teamHasMembers" class="warning-message">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 16v-4M12 8h.01"/>
                </svg>
                <span>Cannot change department when team has members. Remove all members first.</span>
              </div>
              <div *ngIf="teamForm.get('departmentId')?.invalid && teamForm.get('departmentId')?.touched && !teamHasMembers" class="error-text">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 8v4M12 16h.01"/>
                </svg>
                Department is required
              </div>
            </div>

            <!-- Trade -->
            <div class="form-group">
              <label for="trade">Trade</label>
              <div class="input-with-icon">
                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                </svg>
                <select 
                  id="trade"
                  formControlName="trade"
                  class="form-control"
                >
                  <option value="">Select Trade</option>
                  <option *ngFor="let trade of trades" [value]="trade">{{ trade }}</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Form Section: Status -->
        <div class="form-section">
          <div class="section-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            <h3 class="section-title">Team Status</h3>
          </div>
          
          <div class="status-toggle">
            <label class="toggle-container">
              <input 
                type="checkbox" 
                formControlName="isActive"
                class="toggle-input"
              />
              <span class="toggle-slider"></span>
              <span class="toggle-label-text">
                <strong>Active Status</strong>
                <span class="toggle-hint">
                  {{ teamForm.get('isActive')?.value ? 'This team is currently active' : 'This team is currently inactive' }}
                </span>
              </span>
            </label>
          </div>
        </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="onCancel()" [disabled]="saving">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="saving || teamForm.invalid">
              <span *ngIf="saving">Saving...</span>
              <span *ngIf="!saving">Save Changes</span>
            </button>
          </div>
        </form>
      </div>
    </main>
  </div>
</div>

