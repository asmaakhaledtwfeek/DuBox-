<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="page-container">
  <div class="page-content">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading team details...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 8v4M12 16h.01"/>
      </svg>
      <p>{{ error }}</p>
      <button class="btn btn-secondary" (click)="goBack()">Back to Crews</button>
    </div>

    <!-- Crew Details -->
    <div *ngIf="team && !loading">
      <!-- Page Header -->
      <div class="page-header">
        <div class="header-left">
          <button class="btn-back" (click)="goBack()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="12" x2="5" y2="12"/>
              <polyline points="12 19 5 12 12 5"/>
            </svg>
            Back to Crews
          </button>
          <div class="title-section">
            <h1 class="page-title">{{ team.teamName }}</h1>
            <span class="badge" [class.active]="team.isActive" [class.inactive]="!team.isActive">
              {{ team.isActive ? 'Active' : 'Inactive' }}
            </span>
          </div>
          <p class="page-subtitle">{{ team.teamCode }} • {{ team.departmentName || 'No Department' }} • {{ team.trade || 'No Trade' }}</p>
          <div class="info-badge">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            <div class="badge-content">
              <span class="badge-label">Created</span>
              <span class="badge-value">{{ formatDate(team.createdDate) }}</span>
            </div>
          </div>
        </div>
        <div class="header-right" *ngIf="canManageMembers || canEditTeam">
          <button *ngIf="canManageMembers" class="btn btn-secondary" (click)="openAddMemberModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="8.5" cy="7" r="4"/>
              <line x1="20" y1="8" x2="20" y2="14"/>
              <line x1="23" y1="11" x2="17" y2="11"/>
            </svg>
            Add New Member
          </button>
          <button *ngIf="canManageMembers" class="btn btn-secondary" (click)="addMembers()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            Add Members
          </button>
          <button *ngIf="canManageMembers" class="btn btn-secondary" (click)="openReactivateMembersModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 4v6h6"/>
              <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
            </svg>
            Reactivate Members
          </button>
          <button *ngIf="canEditTeam" class="btn btn-primary" (click)="editTeam()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Edit Crew
          </button>
        </div>
      </div>

      <!-- Members Section -->
      <div class="members-section">
        <!-- Members Header -->
        <div class="members-section-header">
          <div class="header-left">
            <div class="header-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
            </div>
            <div class="header-title-section">
              <h2 class="section-title">Crew Members</h2>
              <p class="section-subtitle">{{ teamMembers?.members?.length || 0 }} {{ (teamMembers?.members?.length === 1) ? 'member' : 'members' }}</p>
            </div>
          </div>
          <div class="header-right">
            <div class="info-badge" *ngIf="team.teamLeaderName">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
              <div class="badge-content">
                <span class="badge-label">Crew Leader</span>
                <span class="badge-value">{{ team.teamLeaderName }}</span>
              </div>
            </div>
          
          </div>
        </div>

        <!-- Members Container -->
        <div class="members-container">
            <div *ngIf="!teamMembers || teamMembers.members.length === 0" class="empty-state">
              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
              <h3>No Members</h3>
              <p>No members assigned to this team yet.</p>
            </div>
            <div *ngIf="teamMembers && teamMembers.members.length > 0" class="members-grid">
              <div *ngFor="let member of teamMembers.members" class="member-card">
                <button 
                  *ngIf="canManageMembers"
                  class="btn-remove-icon"
                  (click)="openRemoveMemberModal(member)"
                  title="Remove Member"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                  </svg>
                </button>
                <div class="member-header">
                  <div class="member-avatar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                      <circle cx="12" cy="7" r="4"/>
                    </svg>
                  </div>
                  <div class="member-name">{{ member.employeeName || member.fullName || member.email }}</div>
                </div>
                <div class="member-details">
                  <div class="detail-item" *ngIf="member.employeeCode">
                    <span class="detail-label">Code</span>
                    <span class="detail-value">{{ member.employeeCode }}</span>
                  </div>
                  <div class="detail-item" *ngIf="member.email">
                    <span class="detail-label">Email</span>
                    <span class="detail-value">{{ member.email }}</span>
                  </div>
                  <div class="detail-item" *ngIf="member.mobileNumber">
                    <span class="detail-label">Mobile</span>
                    <span class="detail-value">{{ member.mobileNumber }}</span>
                  </div>
                  <div class="detail-item" *ngIf="!member.employeeCode || !member.employeeName">
                    <span class="detail-label status-incomplete">Status</span>
                    <span class="detail-value status-incomplete">Profile Incomplete</span>
                  </div>
                </div>
                <div class="member-actions" *ngIf="canManageMembers">
                  <button 
                    class="btn-complete-profile"
                    (click)="openCompleteProfileModal(member)"
                    [title]="needsProfileCompletion(member) ? 'Complete Profile' : 'Update Profile'"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    {{ needsProfileCompletion(member) ? 'Complete Profile' : 'Update Profile' }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Complete Profile Modal -->
<div *ngIf="showCompleteProfileModal" class="modal-overlay" (click)="closeCompleteProfileModal()">
  <div class="modal-content complete-profile-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
        </div>
        <div>
      <h2>Complete Member Profile</h2>
          <p class="modal-subtitle">Update employee information to complete the profile</p>
        </div>
      </div>
      <button class="modal-close" (click)="closeCompleteProfileModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <form [formGroup]="completeProfileForm" (ngSubmit)="onCompleteProfile()">
      <div class="modal-body">
        <!-- Success Message -->
        <div *ngIf="completeProfileSuccess" class="success-message">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
          <span>{{ completeProfileSuccess }}</span>
        </div>

        <!-- Error Message -->
        <div *ngIf="completeProfileError" class="error-message">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
          </svg>
          <span>{{ completeProfileError }}</span>
        </div>

        <!-- Profile Information Section -->
        <div class="form-section">
          <div class="section-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            <h3>Employee Information</h3>
        </div>

        <div class="form-group">
          <label for="employeeCode">Employee Code <span class="required">*</span></label>
            <div class="input-with-icon">
              <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
          <input 
            type="text" 
            id="employeeCode"
            formControlName="employeeCode"
            class="form-control"
                placeholder="e.g., EMP001"
            [class.invalid]="completeProfileForm.get('employeeCode')?.invalid && completeProfileForm.get('employeeCode')?.touched"
          />
            </div>
          <div *ngIf="completeProfileForm.get('employeeCode')?.invalid && completeProfileForm.get('employeeCode')?.touched" class="error-text">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
              </svg>
              Employee code is required (max 50 characters)
            </div>
        </div>

        <div class="form-group">
          <label for="employeeName">Employee Name <span class="required">*</span></label>
            <div class="input-with-icon">
              <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
          <input 
            type="text" 
            id="employeeName"
            formControlName="employeeName"
            class="form-control"
                placeholder="Enter full name"
            [class.invalid]="completeProfileForm.get('employeeName')?.invalid && completeProfileForm.get('employeeName')?.touched"
          />
            </div>
          <div *ngIf="completeProfileForm.get('employeeName')?.invalid && completeProfileForm.get('employeeName')?.touched" class="error-text">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
              </svg>
              Employee name is required (max 200 characters)
            </div>
        </div>

        <div class="form-group">
          <label for="mobileNumber">Mobile Number</label>
            <div class="input-with-icon">
              <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
                <line x1="12" y1="18" x2="12.01" y2="18"/>
              </svg>
          <input 
            type="text" 
            id="mobileNumber"
            formControlName="mobileNumber"
            class="form-control"
                placeholder="e.g., +1234567890 (optional)"
            [class.invalid]="completeProfileForm.get('mobileNumber')?.invalid && completeProfileForm.get('mobileNumber')?.touched"
          />
            </div>
          <div *ngIf="completeProfileForm.get('mobileNumber')?.invalid && completeProfileForm.get('mobileNumber')?.touched" class="error-text">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
              </svg>
              Invalid mobile number (max 20 characters)
            </div>
            <p class="help-text">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 16v-4M12 8h.01"/>
              </svg>
              Mobile number is optional but recommended for contact purposes.
            </p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeCompleteProfileModal()" [disabled]="completingProfile">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="completingProfile || completeProfileForm.invalid">
          <svg *ngIf="!completingProfile" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          <div *ngIf="completingProfile" class="spinner-small"></div>
          <span *ngIf="completingProfile">Completing...</span>
          <span *ngIf="!completingProfile">Complete Profile</span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Remove Member Confirmation Modal -->
<div *ngIf="showRemoveConfirmModal" class="modal-overlay remove-modal-overlay" (click)="closeRemoveMemberModal()">
  <div class="modal-content remove-member-modal" (click)="$event.stopPropagation()">
    <button class="modal-close-icon" (click)="closeRemoveMemberModal()" [disabled]="removingMember">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>

    <div class="modal-body remove-modal-body">
      <!-- Error Message -->
      <div *ngIf="removeMemberError" class="error-message remove-error">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span>{{ removeMemberError }}</span>
      </div>

      <!-- Warning Icon Container -->
      <div class="remove-icon-container">
        <div class="remove-icon-wrapper">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <line x1="17" y1="11" x2="23" y2="11"></line>
          </svg>
        </div>
      </div>

      <!-- Confirmation Message -->
      <div class="remove-confirm-content">
        <h2 class="remove-title">Remove Crew Member?</h2>
        <p class="remove-description">
          Are you sure you want to remove 
          <span class="member-name-highlight">{{ memberToRemove?.employeeName || memberToRemove?.fullName || memberToRemove?.email }}</span> 
          from this team?
        </p>
        <div class="remove-warning-box">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
            <line x1="12" y1="9" x2="12" y2="13"></line>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
          <div class="warning-text">
            <strong>Warning:</strong> This action cannot be undone. The member will be removed from the team immediately.
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer remove-modal-footer">
      <button type="button" class="btn btn-cancel" (click)="closeRemoveMemberModal()" [disabled]="removingMember">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        Cancel
      </button>
      <button type="button" class="btn btn-remove-danger" (click)="confirmRemoveMember()" [disabled]="removingMember">
        <svg *ngIf="!removingMember" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="3 6 5 6 21 6"></polyline>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          <line x1="10" y1="11" x2="10" y2="17"></line>
          <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
        <span class="btn-spinner" *ngIf="removingMember"></span>
        <span *ngIf="removingMember">Removing...</span>
        <span *ngIf="!removingMember">Remove Member</span>
      </button>
    </div>
  </div>
</div>

<!-- Add Crew Member Modal -->
<div *ngIf="showAddMemberModal" class="modal-overlay" (click)="closeAddMemberModal()">
  <div class="modal-content add-member-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="8.5" cy="7" r="4"/>
            <line x1="20" y1="8" x2="20" y2="14"/>
            <line x1="23" y1="11" x2="17" y2="11"/>
          </svg>
        </div>
        <div>
          <h2>Add New Crew Member</h2>
          <p class="modal-subtitle">Fill in the details to add a new member to your crew</p>
        </div>
      </div>
      <button class="modal-close" (click)="closeAddMemberModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <form [formGroup]="addMemberForm" (ngSubmit)="onAddMemberSubmit()">
      <div class="modal-body">
        <!-- Success Message -->
        <div *ngIf="addMemberSuccess" class="success-message">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
          <span>{{ addMemberSuccess }}</span>
        </div>

        <!-- Error Message -->
        <div *ngIf="addMemberError" class="error-message">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 8v4M12 16h.01"/>
          </svg>
          <span>{{ addMemberError }}</span>
        </div>

        <!-- Basic Information Section -->
        <div class="form-section">
          <div class="section-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            <h3>Basic Information</h3>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="firstName">First Name <span class="required">*</span></label>
              <div class="input-with-icon">
                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                <input 
                  type="text" 
                  id="firstName"
                  formControlName="firstName"
                  class="form-control"
                  placeholder="Enter first name"
                  [class.invalid]="addMemberForm.get('firstName')?.invalid && addMemberForm.get('firstName')?.touched"
                />
              </div>
              <div *ngIf="addMemberForm.get('firstName')?.invalid && addMemberForm.get('firstName')?.touched" class="error-text">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                First name is required (max 100 characters)
              </div>
            </div>

            <div class="form-group">
              <label for="lastName">Last Name <span class="required">*</span></label>
              <div class="input-with-icon">
                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                <input 
                  type="text" 
                  id="lastName"
                  formControlName="lastName"
                  class="form-control"
                  placeholder="Enter last name"
                  [class.invalid]="addMemberForm.get('lastName')?.invalid && addMemberForm.get('lastName')?.touched"
                />
              </div>
              <div *ngIf="addMemberForm.get('lastName')?.invalid && addMemberForm.get('lastName')?.touched" class="error-text">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                Last name is required (max 100 characters)
              </div>
            </div>
          </div>

        <div class="form-group">
            <label for="employeeCode">Employee Code <span class="required">*</span></label>
            <div class="input-with-icon">
              <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
          <input 
            type="text" 
                id="employeeCode"
                formControlName="employeeCode"
            class="form-control"
                placeholder="e.g., EMP001"
                [class.invalid]="addMemberForm.get('employeeCode')?.invalid && addMemberForm.get('employeeCode')?.touched"
              />
            </div>
            <div *ngIf="addMemberForm.get('employeeCode')?.invalid && addMemberForm.get('employeeCode')?.touched" class="error-text">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
              </svg>
              Employee code is required (max 50 characters)
            </div>
          </div>

          <!-- Crew Information (Read-only) -->
          <div class="form-row">
            <div class="form-group">
              <label for="department">Department</label>
              <div class="input-with-icon">
                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                  <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
                <input 
                  type="text" 
                  id="department"
                  formControlName="department"
                  class="form-control readonly-input"
                  readonly
                />
              </div>
            </div>

            <div class="form-group">
              <label for="trade">Trade</label>
              <div class="input-with-icon">
                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                </svg>
                <input 
                  type="text" 
                  id="trade"
                  formControlName="trade"
                  class="form-control readonly-input"
                  readonly
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Account Creation Section -->
        <div class="form-section">
          <div class="checkbox-card">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                formControlName="isCreateAccount"
                class="checkbox-input"
              />
              <div class="checkbox-content">
                <div class="checkbox-header">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="8.5" cy="7" r="4"/>
                    <line x1="20" y1="8" x2="20" y2="14"/>
                    <line x1="23" y1="11" x2="17" y2="11"/>
                  </svg>
                  <span class="checkbox-text">Create user account for this member</span>
                </div>
                <p class="checkbox-help">Enable login access by creating a user account with email and temporary password.</p>
              </div>
            </label>
          </div>

          <!-- Conditional fields shown only when isCreateAccount is true -->
          <div *ngIf="addMemberForm.get('isCreateAccount')?.value" class="conditional-fields">
            <div class="conditional-header">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                <polyline points="22,6 12,13 2,6"/>
              </svg>
              <h4>Account Credentials</h4>
            </div>

            <div class="form-group">
              <label for="email">Email Address <span class="required">*</span></label>
              <div class="input-with-icon">
                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                  <polyline points="22,6 12,13 2,6"/>
                </svg>
                <input 
                  type="email" 
                  id="email"
                  formControlName="email"
                  class="form-control"
                  placeholder="member@example.com"
                  [class.invalid]="addMemberForm.get('email')?.invalid && addMemberForm.get('email')?.touched"
                />
              </div>
              <div *ngIf="addMemberForm.get('email')?.invalid && addMemberForm.get('email')?.touched" class="error-text">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <span *ngIf="addMemberForm.get('email')?.errors?.['required']">Email is required when creating an account</span>
                <span *ngIf="addMemberForm.get('email')?.errors?.['email']">Please enter a valid email address</span>
                <span *ngIf="addMemberForm.get('email')?.errors?.['maxlength']">Email must not exceed 100 characters</span>
              </div>
            </div>

        <div class="form-group">
              <label for="temporaryPassword">Temporary Password <span class="required">*</span></label>
              <div class="input-with-icon input-with-toggle">
                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                  <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
          <input 
                  [type]="showTemporaryPassword ? 'text' : 'password'" 
                  id="temporaryPassword"
                  formControlName="temporaryPassword"
            class="form-control"
                  placeholder="Enter temporary password"
                  [class.invalid]="addMemberForm.get('temporaryPassword')?.invalid && addMemberForm.get('temporaryPassword')?.touched"
                />
                <button 
                  type="button" 
                  class="toggle-password-btn"
                  (click)="toggleTemporaryPasswordVisibility()"
                  [title]="showTemporaryPassword ? 'Hide password' : 'Show password'"
                >
                  <!-- Eye Icon (Show) -->
                  <svg *ngIf="!showTemporaryPassword" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                  <!-- Eye Off Icon (Hide) -->
                  <svg *ngIf="showTemporaryPassword" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                    <line x1="1" y1="1" x2="23" y2="23"/>
                  </svg>
                </button>
              </div>
              <div *ngIf="addMemberForm.get('temporaryPassword')?.invalid && addMemberForm.get('temporaryPassword')?.touched" class="error-text">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <span *ngIf="addMemberForm.get('temporaryPassword')?.errors?.['required']">Temporary password is required</span>
                <span *ngIf="addMemberForm.get('temporaryPassword')?.errors?.['minlength']">Password must be at least 6 characters</span>
                <span *ngIf="addMemberForm.get('temporaryPassword')?.errors?.['maxlength']">Password must not exceed 100 characters</span>
              </div>
              <p class="help-text">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 16v-4M12 8h.01"/>
                </svg>
                The user will use this password for their first login.
              </p>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeAddMemberModal()" [disabled]="addingMember">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="addingMember || addMemberForm.invalid">
          <svg *ngIf="!addingMember" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="8.5" cy="7" r="4"/>
            <line x1="20" y1="8" x2="20" y2="14"/>
            <line x1="23" y1="11" x2="17" y2="11"/>
          </svg>
          <div *ngIf="addingMember" class="spinner-small"></div>
          <span *ngIf="addingMember">Adding Member...</span>
          <span *ngIf="!addingMember">Add Member</span>
        </button>
      </div>
    </form>
  </div>
</div>


