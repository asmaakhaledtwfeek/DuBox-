<div class="status-modal-backdrop" *ngIf="isOpen && issue" (click)="onBackdropClick()">
  <div class="status-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-title-section">
          <h3 class="modal-title">Assign to Crew</h3>
          <div class="header-badges">
            <span class="issue-type-badge-small">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                <path d="M2 17l10 5 10-5"/>
                <path d="M2 12l10 5 10-5"/>
              </svg>
              {{ issue.issueType || 'Issue' }}
            </span>
            <span class="severity-badge-small" [ngClass]="'severity-' + (issue.severity ? issue.severity.toLowerCase() : '')">
              {{ issue.severity || 'â€”' }}
            </span>
          </div>
        </div>
      </div>
      <button class="icon-button" (click)="onClose()" [disabled]="assignLoading" aria-label="Close modal">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <div class="modal-content">
      <div class="modal-body">
        <div class="form-group">
          <label class="modal-label">Assign to Crew <span class="required">*</span></label>
          <select 
            class="modal-input" 
            [(ngModel)]="selectedTeamId"
            (change)="onTeamSelectionChange($any($event.target).value)"
            [disabled]="assignLoading || loadingTeams"
          >
            <option [value]="null">Select a Crew</option>
            <option *ngFor="let team of availableTeams" [value]="team.teamId">
              {{ team.teamName }} ({{ team.teamCode }})
            </option>
          </select>
          <div class="loading-text" *ngIf="loadingTeams">Loading teams...</div>
          <small class="helper-text" *ngIf="!loadingTeams && availableTeams.length === 0">
            No Crew available. Please contact your administrator.
          </small>
        </div>

        <div class="form-group" *ngIf="selectedTeamId">
          <label class="modal-label">Assign to Crew Member <span class="optional">(Optional)</span></label>
          <select 
            class="modal-input" 
            [(ngModel)]="selectedMemberId"
            [disabled]="assignLoading || loadingMembers"
          >
            <option [value]="null">Select a Member (Optional)</option>
            <option *ngFor="let member of availableMembers" [value]="member.teamMemberId">
              {{ member.employeeName || member.fullName || member.email }}
            </option>
          </select>
          <div class="loading-text" *ngIf="loadingMembers">Loading members...</div>
          <small class="helper-text" *ngIf="!loadingMembers && availableMembers.length === 0 && selectedTeamId">
            No members available for this Crew.
          </small>
        </div>

        <div class="current-assignment" *ngIf="issue?.assignedTeamName">
          <p class="info-text">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="16" x2="12" y2="12"/>
              <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            Currently assigned to: <strong>{{ issue.assignedTeamName }}</strong>
          </p>
        </div>

        <p class="modal-error" *ngIf="assignError">{{ assignError }}</p>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="onClose()" [disabled]="assignLoading">
        Cancel
      </button>
      <button 
        class="btn btn-primary" 
        (click)="onAssign()" 
        [disabled]="assignLoading || loadingTeams"
      >
        <span *ngIf="assignLoading">Assigning...</span>
        <span *ngIf="!assignLoading">{{ selectedTeamId ? 'Assign' : 'Unassign' }}</span>
      </button>
    </div>
  </div>
</div>

