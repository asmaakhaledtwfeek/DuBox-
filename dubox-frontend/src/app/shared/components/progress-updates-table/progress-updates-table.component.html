<div class="progress-updates-card">
  <div class="card-header">
    <div>
      <h3>Progress Updates</h3>
      <p class="subtitle">Latest updates recorded for this box</p>
    </div>
    <button class="btn btn-outline" type="button" (click)="onRefresh()" [disabled]="loading">
      <ng-container *ngIf="!loading; else refreshing">
        Refresh
      </ng-container>
      <ng-template #refreshing>
        <span class="spinner small"></span>
        Updating...
      </ng-template>
    </button>
  </div>

  <div *ngIf="error" class="alert alert-error">
    <span>{{ error }}</span>
  </div>

  <div *ngIf="loading && !error" class="loading-state">
    <span class="spinner large"></span>
    <p>Loading progress updates...</p>
  </div>

  <div *ngIf="!loading && !error">
    <div *ngIf="updates && updates.length > 0; else emptyState" class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Updated By</th>
            <th>Progress</th>
            <th>Notes</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let update of updates; trackBy: trackById" (click)="openDetails(update)">
            <td>
              {{ update.updateDate | date: 'MMM d, y, h:mm a' }}
            </td>
            <td>
              {{ update.updatedByName || update.updatedBy || '—' }}
            </td>
            <td>
              <span class="progress-pill" [ngClass]="{
                'pill-low': update.progressPercentage < 25,
                'pill-medium': update.progressPercentage >= 25 && update.progressPercentage < 75,
                'pill-high': update.progressPercentage >= 75
              }">
                {{ update.progressPercentage | number: '1.0-2' }}%
              </span>
            </td>
            <td class="notes">
              {{ update.workDescription || update.issuesEncountered || '—' }}
            </td>
            <td class="action">
              <button type="button" class="link-btn" (click)="openDetails(update); $event.stopPropagation()">View</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <ng-template #emptyState>
      <div class="empty-state">
        <p>No progress updates have been recorded yet.</p>
      </div>
    </ng-template>
  </div>
</div>


